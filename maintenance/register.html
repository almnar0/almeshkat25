<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#7c3aed">
    <title>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙŠØ§Ù†Ø©</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700;800&family=Tajawal:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="auth.css">
    <script>
        // Check if user is already logged in and redirect to appropriate dashboard
        (function() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
            if (currentUser && currentUser.userType) {
                // User is already logged in, redirect to their dashboard
                if (currentUser.userType === 'client') {
                    window.location.href = 'client-dashboard.html';
                } else if (currentUser.userType === 'technician') {
                    window.location.href = 'tech-dashboard.html';
                } else if (currentUser.userType === 'admin') {
                    window.location.href = 'admin-dashboard.html';
                }
            }
        })();
    </script>
</head>
<body class="auth-page">
    <div class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <div class="auth-logo">ğŸ”§</div>
                <h1 class="auth-title">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h1>
                <p class="auth-subtitle">Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙŠØ§Ù†Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ</p>
            </div>
            
            <form class="auth-form" id="registerForm">
                <!-- User Type Selection -->
                <div class="form-group">
                    <label class="form-label">Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="userType" value="client" checked>
                            <span class="radio-label">
                                <span class="radio-icon">ğŸ‘¤</span>
                                <span class="radio-text">
                                    <strong>Ø¹Ù…ÙŠÙ„</strong>
                                    <small>Ù„Ø±ÙØ¹ Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©</small>
                                </span>
                            </span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="userType" value="technician">
                            <span class="radio-label">
                                <span class="radio-icon">ğŸ”§</span>
                                <span class="radio-text">
                                    <strong>ÙÙ†ÙŠ</strong>
                                    <small>Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</small>
                                </span>
                            </span>
                        </label>
                    </div>
                </div>

                <!-- Name -->
                <div class="form-group">
                    <label for="name" class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ *</label>
                    <input type="text" id="name" name="name" class="form-input" required placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„">
                </div>

                <!-- Phone -->
                <div class="form-group">
                    <label for="phone" class="form-label">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ *</label>
                    <input type="tel" id="phone" name="phone" class="form-input" required placeholder="05xxxxxxxx">
                </div>

                <!-- Email -->
                <div class="form-group">
                    <label for="email" class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ *</label>
                    <input type="email" id="email" name="email" class="form-input" required placeholder="example@email.com">
                </div>

                <!-- Password -->
                <div class="form-group">
                    <label for="password" class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± *</label>
                    <input type="password" id="password" name="password" class="form-input" required placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù‚ÙˆÙŠØ©">
                    <small class="form-hint">ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 8 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„</small>
                </div>

                <!-- Confirm Password -->
                <div class="form-group">
                    <label for="confirmPassword" class="form-label">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± *</label>
                    <input type="password" id="confirmPassword" name="confirmPassword" class="form-input" required placeholder="Ø£Ø¹Ø¯ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                </div>

                <!-- School Name (Optional for clients) -->
                <div class="form-group" id="schoolGroup">
                    <label for="schoolName" class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                    <input type="text" id="schoolName" name="schoolName" class="form-input" placeholder="Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„Ù…Ø´ÙƒØ§Ø©">
                </div>

                <!-- Specialization (For technicians) -->
                <div class="form-group" id="specializationGroup" style="display: none;">
                    <label for="specialization" class="form-label">Ø§Ù„ØªØ®ØµØµ *</label>
                    <select id="specialization" name="specialization" class="form-input">
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØ®ØµØµ</option>
                        <option value="electrical">ÙƒÙ‡Ø±Ø¨Ø§Ø¡</option>
                        <option value="plumbing">Ø³Ø¨Ø§ÙƒØ©</option>
                        <option value="carpentry">Ù†Ø¬Ø§Ø±Ø©</option>
                        <option value="it">ØªÙ‚Ù†ÙŠØ© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</option>
                        <option value="general">ØµÙŠØ§Ù†Ø© Ø¹Ø§Ù…Ø©</option>
                    </select>
                </div>

                <!-- Terms -->
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" required>
                        <span>Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ <a href="#" class="link">Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…</a></span>
                    </label>
                </div>

                <!-- Submit Button -->
                <button type="submit" class="btn btn-primary btn-full">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</button>

                <!-- Alternative -->
                <div class="auth-footer">
                    <p>Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ <a href="login.html" class="link">Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a></p>
                    <p><a href="index.html" class="link">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></p>
                </div>
            </form>
        </div>
    </div>

    <script src="auth.js"></script>
    <script src="api.js"></script>
    <script>
        // Handle user type change
        const userTypeRadios = document.querySelectorAll('input[name="userType"]');
        const schoolGroup = document.getElementById('schoolGroup');
        const specializationGroup = document.getElementById('specializationGroup');

        userTypeRadios.forEach(radio => {
            radio.addEventListener('change', (e) => {
                if (e.target.value === 'client') {
                    schoolGroup.style.display = 'block';
                    specializationGroup.style.display = 'none';
                    document.getElementById('specialization').removeAttribute('required');
                } else {
                    schoolGroup.style.display = 'none';
                    specializationGroup.style.display = 'block';
                    document.getElementById('specialization').setAttribute('required', 'required');
                }
            });
        });

        // Handle form submission
        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = {
                userType: document.querySelector('input[name="userType"]:checked').value,
                name: document.getElementById('name').value,
                phone: document.getElementById('phone').value,
                email: document.getElementById('email').value,
                password: document.getElementById('password').value,
                confirmPassword: document.getElementById('confirmPassword').value,
                specialty: document.getElementById('specialization').value
            };

            // Validate passwords match
            if (formData.password !== formData.confirmPassword) {
                alert('ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©');
                return;
            }

            // Validate password length
            if (formData.password.length < 8) {
                alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 8 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                return;
            }

            try {
                // Try to use API first
                const result = await UsersAPI.register({
                    name: formData.name,
                    email: formData.email,
                    password: formData.password,
                    phone: formData.phone,
                    userType: formData.userType,
                    specialty: formData.specialty
                });
                
                alert('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­! Ø³ÙŠØªÙ… ØªØ­ÙˆÙŠÙ„Ùƒ Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
                window.location.href = 'login.html';
            } catch (error) {
                console.error('API registration failed, falling back to localStorage:', error);
                
                // Fallback to localStorage
                let users = JSON.parse(localStorage.getItem('users') || '[]');
                
                if (users.some(user => user.email === formData.email)) {
                    alert('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹');
                    return;
                }

                const user = {
                    id: Date.now().toString(),
                    userType: formData.userType,
                    name: formData.name,
                    phone: formData.phone,
                    email: formData.email,
                    password: formData.password,
                    specialty: formData.specialty,
                    createdAt: new Date().toISOString(),
                    isActive: true,
                    averageRating: 0,
                    completedJobs: 0
                };

                users.push(user);
                localStorage.setItem('users', JSON.stringify(users));
                
                alert('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­! Ø³ÙŠØªÙ… ØªØ­ÙˆÙŠÙ„Ùƒ Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
                window.location.href = 'login.html';
            }
        });
    </script>
</body>
</html>
