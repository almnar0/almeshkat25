<!DOCTYPE html>
<html lang="ar" dir="rtl" data-theme="dark">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Ù†Ø¸Ø§Ù… Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</title>
        <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
        <script>
            // Force permanent dark mode
            (function () {
                document.documentElement.setAttribute('data-theme', 'dark');
            })();
        </script>
        <style>
        :root {
            --radius-lg: 32px;
            --radius-md: 22px;
            --radius-sm: 14px;
            --transition: 0.35s ease;
        }

        :root,
        :root[data-theme="dark"] {
            color-scheme: dark;
            --bg: #0b1021;
            --bg-secondary: rgba(15, 23, 42, 0.85);
            --surface: rgba(16, 24, 48, 0.9);
            --surface-alt: rgba(21, 31, 60, 0.92);
            --surface-border: rgba(148, 163, 184, 0.16);
            --surface-strong: rgba(12, 18, 36, 0.92);
            --text: #f8fbff;
            --text-muted: #cbd5f5;
            --heading: #ffffff;
            --accent: #fbbf24;
            --primary: #667eea;
            --primary-2: #7645ea;
            --primary-soft: rgba(102, 126, 234, 0.18);
            --success: #34d399;
            --danger: #f87171;
            --pending: #fbbf24;
            --shadow: 0 28px 72px rgba(8, 12, 24, 0.35);
            --layer-faint: rgba(255, 255, 255, 0.05);
            --layer-soft: rgba(255, 255, 255, 0.08);
            --layer-strong: rgba(255, 255, 255, 0.12);
            --layer-dash: rgba(255, 255, 255, 0.18);
            --surface-input: rgba(255, 255, 255, 0.08);
            --filter-bg: rgba(255, 255, 255, 0.08);
            --filter-bg-active: rgba(102, 126, 234, 0.24);
            --page-gradient: linear-gradient(135deg, #0b1021 0%, #101b46 48%, #1d47b8 100%);
            --glow-primary: rgba(99, 102, 241, 0.45);
            --glow-secondary: rgba(251, 191, 36, 0.28);
            --button-disabled-bg: rgba(30, 41, 59, 0.7);
            --button-disabled-text: rgba(226, 232, 240, 0.6);
            --button-disabled-border: rgba(71, 85, 105, 0.45);
        }

        :root[data-theme="light"] {
            color-scheme: light;
            --bg: #f4f6ff;
            --bg-secondary: rgba(255, 255, 255, 0.92);
            --surface: rgba(255, 255, 255, 0.96);
            --surface-alt: rgba(255, 255, 255, 0.98);
            --surface-border: rgba(148, 163, 184, 0.28);
            --surface-strong: rgba(237, 242, 255, 0.95);
            --text: #1e293b;
            --text-muted: #4b5878;
            --heading: #0f172a;
            --accent: #7c3aed;
            --primary: #4f46e5;
            --primary-2: #6366f1;
            --primary-soft: rgba(99, 102, 241, 0.18);
            --success: #16a34a;
            --danger: #dc2626;
            --pending: #d97706;
            --shadow: 0 24px 48px rgba(15, 23, 42, 0.14);
            --layer-faint: rgba(15, 23, 42, 0.04);
            --layer-soft: rgba(15, 23, 42, 0.08);
            --layer-strong: rgba(15, 23, 42, 0.12);
            --layer-dash: rgba(15, 23, 42, 0.2);
            --surface-input: rgba(241, 245, 255, 0.9);
            --filter-bg: rgba(15, 23, 42, 0.05);
            --filter-bg-active: rgba(99, 102, 241, 0.16);
            --page-gradient: linear-gradient(135deg, #eef2ff 0%, #f8fafc 42%, #dbeafe 100%);
            --glow-primary: rgba(99, 102, 241, 0.26);
            --glow-secondary: rgba(251, 191, 36, 0.16);
            --button-disabled-bg: rgba(226, 232, 240, 0.85);
            --button-disabled-text: rgba(71, 85, 105, 0.7);
            --button-disabled-border: rgba(148, 163, 184, 0.4);
        }

        *, *::before, *::after {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            min-height: 100vh;
            font-family: 'Tajawal', 'Cairo', sans-serif;
            background: var(--page-gradient);
            color: var(--text);
            padding: clamp(18px, 3.5vw, 38px);
            overflow-x: hidden;
            transition: background 0.45s ease, color 0.3s ease;
        }

        body::before,
        body::after {
            content: '';
            position: fixed;
            inset: auto;
            z-index: -2;
            pointer-events: none;
            border-radius: 50%;
            filter: blur(0.5px);
        }

        body::before {
            width: 520px;
            height: 520px;
            background: radial-gradient(circle, var(--glow-primary) 0%, rgba(99, 102, 241, 0));
            top: -140px;
            inset-inline-start: -180px;
        }

        body::after {
            width: 420px;
            height: 420px;
            background: radial-gradient(circle, var(--glow-secondary) 0%, rgba(99, 102, 241, 0));
            bottom: -160px;
            inset-inline-end: -130px;
        }

        h1, h2, h3 {
            font-family: 'Cairo', 'Tajawal', sans-serif;
            font-weight: 800;
            color: var(--heading);
        }

        p, span, label {
            font-size: 0.96rem;
            line-height: 1.75;
            color: var(--text-muted);
        }

        .app-shell {
            width: min(1220px, 100%);
            margin: 0 auto;
        }

        .surface-card {
            position: relative;
            background: var(--surface);
            border-radius: var(--radius-lg);
            border: 1px solid var(--surface-border);
            backdrop-filter: blur(24px);
            box-shadow: var(--shadow);
        }

        .hero-card {
            padding: clamp(28px, 4vw, 42px);
            margin-bottom: clamp(26px, 5vw, 42px);
        }

        .hero-top {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 18px;
            align-items: center;
        }

        .hero-brand {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .hero-symbol {
            width: 58px;
            height: 58px;
            border-radius: 18px;
            background: linear-gradient(140deg, var(--primary), var(--primary-2));
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 1.45rem;
            color: #fff;
            box-shadow: 0 18px 38px rgba(102, 126, 234, 0.35);
        }

        .hero-title {
            margin: 0;
            font-size: clamp(1.9rem, 4.6vw, 2.7rem);
            letter-spacing: -0.01em;
        }

        .hero-description {
            margin-top: 12px;
            max-width: 720px;
            font-size: 1.02rem;
        }

        .hero-pills {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
            gap: 18px;
            margin-top: clamp(22px, 5vw, 38px);
        }

        .hero-pill {
            padding: 18px 20px;
            background: var(--surface-alt);
            border-radius: var(--radius-md);
            border: 1px solid var(--layer-soft);
            position: relative;
        }

        .hero-pill strong {
            display: block;
            font-size: 1.8rem;
            line-height: 1.35;
        }

        .hero-pill small {
            color: var(--text-muted);
            font-size: 0.82rem;
            letter-spacing: 0.02em;
        }

        .hero-pill::after {
            content: '';
            position: absolute;
            inset-inline-start: 18px;
            inset-block-end: 18px;
            width: 32px;
            height: 2px;
            border-radius: 999px;
            background: var(--primary-soft);
        }

        .view-section {
            display: none;
            animation: fadeInUp 0.45s ease;
        }

        .view-section.active {
            display: block;
        }

        .grid-split {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: clamp(22px, 4vw, 32px);
            align-items: start;
        }

        .card {
            padding: clamp(26px, 3.5vw, 34px);
            border-radius: var(--radius-lg);
            background: var(--surface-alt);
            border: 1px solid var(--layer-soft);
            box-shadow: var(--shadow);
        }

        .card h2 {
            margin-top: 0;
            margin-bottom: 18px;
        }

        .card h3 {
            margin-top: 0;
            margin-bottom: 14px;
            font-size: 1.15rem;
        }

        .form-grid {
            display: grid;
            gap: 16px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-muted);
        }

        input, textarea, select {
            width: 100%;
            padding: 14px 16px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--layer-strong);
            background: var(--surface-input);
            color: var(--text);
            font-family: 'Tajawal', sans-serif;
            font-size: 1rem;
            transition: border-color var(--transition), box-shadow var(--transition);
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: rgba(102, 126, 234, 0.6);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.18);
        }

        textarea {
            min-height: 140px;
            resize: vertical;
        }

        select option {
            background: #0f172a;
            color: #f1f5ff;
        }

        .action-row {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        button {
            padding: 14px 22px;
            border-radius: 999px;
            border: none;
            cursor: pointer;
            font-family: 'Tajawal', sans-serif;
            font-size: 1.02rem;
            font-weight: 700;
            transition: transform 0.18s ease, box-shadow 0.18s ease;
            background: linear-gradient(135deg, var(--primary), var(--primary-2));
            color: #fff;
            box-shadow: 0 16px 32px rgba(102, 126, 234, 0.25);
        }

        button:hover {
            transform: translateY(-1px);
            box-shadow: 0 20px 32px rgba(102, 126, 234, 0.32);
        }

        .btn-secondary {
            background: var(--filter-bg);
            color: var(--text);
            box-shadow: none;
            border: 1px solid transparent;
        }

        .btn-danger {
            background: linear-gradient(135deg, #f87171, #ef4444);
            box-shadow: 0 16px 32px rgba(248, 113, 113, 0.25);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--layer-strong);
            color: var(--text);
            box-shadow: none;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 999px;
            background: var(--layer-soft);
            font-size: 0.82rem;
            color: var(--text-muted);
        }

        .status-pill {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 14px;
            border-radius: 999px;
            font-size: 0.86rem;
            font-weight: 700;
        }

        .status-pending {
            background: rgba(251, 191, 36, 0.16);
            color: var(--pending);
            border: 1px solid rgba(251, 191, 36, 0.45);
        }

        .status-approved {
            background: rgba(52, 211, 153, 0.16);
            color: var(--success);
            border: 1px solid rgba(52, 211, 153, 0.35);
        }

        .status-rejected {
            background: rgba(248, 113, 113, 0.16);
            color: var(--danger);
            border: 1px solid rgba(248, 113, 113, 0.35);
        }

        .suggestions-list {
            display: grid;
            gap: 16px;
        }

        .suggestion-item {
            padding: 22px;
            border-radius: var(--radius-md);
            background: var(--surface);
            border: 1px solid var(--layer-soft);
        }

        .suggestion-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 16px;
            flex-wrap: wrap;
        }

        .suggestion-title {
            font-size: 1.1rem;
            color: var(--heading);
            margin: 0;
        }

        .suggestion-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 12px;
            font-size: 0.86rem;
        }

        .suggestion-text {
            margin-top: 14px;
            color: var(--text);
            line-height: 1.75;
        }

        .timeline {
            margin-top: 20px;
            padding-inline-start: 18px;
            border-inline-start: 2px solid var(--layer-strong);
            display: grid;
            gap: 16px;
        }

        .timeline-step {
            position: relative;
            padding-inline-start: 18px;
        }

        .timeline-step::before {
            content: '';
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--primary);
            position: absolute;
            inset-inline-start: -24px;
            inset-block-start: 6px;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.18);
        }

        .timeline-step strong {
            display: block;
            color: var(--heading);
            margin-bottom: 4px;
        }

        .timeline-step small {
            color: rgba(203, 213, 225, 0.7);
        }

        .empty-state {
            text-align: center;
            padding: 42px 28px;
            border-radius: var(--radius-md);
            background: var(--layer-faint);
            border: 1px dashed var(--layer-dash);
        }

        .insights-grid {
            display: grid;
            gap: 16px;
        }

        .insight-row {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .chip {
            padding: 6px 12px;
            border-radius: 999px;
            background: var(--layer-soft);
            font-size: 0.82rem;
            color: var(--text-muted);
        }

        .distribution-list {
            display: grid;
            gap: 12px;
            margin-top: 10px;
        }

        .distribution-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--layer-faint);
            border-radius: var(--radius-sm);
            padding: 10px 14px;
            font-size: 0.88rem;
        }

        .progress-bar {
            position: relative;
            height: 6px;
            border-radius: 999px;
            background: var(--layer-soft);
            overflow: hidden;
            margin-top: 8px;
        }

        .progress-bar span {
            display: block;
            height: 100%;
            border-radius: inherit;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.9), rgba(118, 69, 234, 0.7));
        }

        .admin-toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
        }

        .toolbar-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .toolbar-group input[type="search"] {
            min-width: 240px;
            border-radius: 999px;
        }

        .filter-button {
            background: var(--filter-bg);
            color: var(--text-muted);
            border-radius: 999px;
            padding: 8px 16px;
            cursor: pointer;
            border: 1px solid transparent;
            transition: background var(--transition), color var(--transition), border var(--transition);
            font-size: 0.88rem;
        }

        .filter-button.active {
            background: var(--filter-bg-active);
            color: #fff;
            border-color: rgba(102, 126, 234, 0.35);
        }

        .status-actions {
            display: flex;
            gap: 10px;
            margin-top: 18px;
        }

        .status-actions button {
            flex: 1;
            min-width: 110px;
        }

        .status-actions .btn-success {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            box-shadow: 0 16px 32px rgba(34, 197, 94, 0.25);
        }

        .status-actions .btn-danger {
            background: linear-gradient(135deg, #f87171, #ef4444);
            box-shadow: 0 16px 32px rgba(248, 113, 113, 0.25);
        }

        .status-legend {
            display: grid;
            gap: 10px;
            margin-top: 18px;
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .status-banner {
            padding: 16px 18px;
            border-radius: var(--radius-md);
            background: var(--layer-faint);
            border: 1px solid var(--layer-strong);
            margin-bottom: 18px;
        }

        .status-banner strong {
            color: var(--heading);
        }

        .status-banner span {
            color: var(--text-muted);
            font-size: 0.88rem;
        }

        .logout-row {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 18px;
        }

        .highlight-card {
            background: var(--layer-faint);
            border: 1px solid var(--layer-soft);
            border-radius: var(--radius-md);
            padding: 18px 20px;
            display: grid;
            gap: 12px;
        }

        .highlight-card strong {
            color: var(--accent);
            font-size: 0.95rem;
        }

        .helper-strip {
            margin-top: 22px;
            padding: 18px;
            border-radius: var(--radius-md);
            background: var(--primary-soft);
            border: 1px solid rgba(102, 126, 234, 0.28);
            color: var(--text);
            font-size: 0.88rem;
        }

        .toast {
            position: fixed;
            inset-inline-start: 50%;
            inset-block-end: 32px;
            transform: translateX(-50%) translateY(120%);
            padding: 14px 22px;
            border-radius: 999px;
            background: rgba(15, 23, 42, 0.92);
            color: #fff;
            font-size: 0.95rem;
            box-shadow: 0 24px 54px rgba(15, 23, 42, 0.45);
            transition: transform 0.4s ease, opacity 0.4s ease;
            opacity: 0;
            z-index: 99;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .section-heading {
            margin-bottom: 18px;
        }

        .section-heading span {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.84rem;
            font-weight: 600;
            color: var(--accent);
        }

        /* Theme toggle removed - permanent dark mode */

        .admin-access-cta {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, var(--primary), var(--primary-2));
            color: #fff;
            padding: 12px 22px;
            border-radius: 999px;
            font-size: 0.96rem;
            font-weight: 800;
            border: none;
            box-shadow: 0 14px 32px rgba(102, 126, 234, 0.25);
        }

        .admin-access-cta:hover {
            transform: translateY(-1px);
            box-shadow: 0 20px 36px rgba(102, 126, 234, 0.32);
        }

        .admin-access-cta:focus-visible {
            outline: 3px solid rgba(99, 102, 241, 0.45);
            outline-offset: 4px;
        }

        button:disabled {
            cursor: not-allowed;
            opacity: 0.85;
            background: var(--button-disabled-bg);
            color: var(--button-disabled-text);
            box-shadow: none;
            border: 1px solid var(--button-disabled-border);
            transform: none;
        }

        .status-actions button {
            position: relative;
            overflow: hidden;
        }

        .status-actions button:not(:disabled)::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: inherit;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), transparent);
            opacity: 0;
            transition: opacity 0.25s ease;
        }

        .status-actions button:not(:disabled):hover::after {
            opacity: 1;
        }

        .status-actions button.is-current:disabled {
            opacity: 1;
            animation: selectPulse 0.6s ease;
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.25);
        }

        .status-actions .btn-secondary:disabled {
            background: linear-gradient(135deg, var(--primary), var(--primary-2));
            color: #fff;
        }

        .status-actions .btn-success:disabled {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: #fff;
            box-shadow: 0 16px 32px rgba(34, 197, 94, 0.3);
        }

        .status-actions .btn-danger:disabled {
            background: linear-gradient(135deg, #f87171, #ef4444);
            color: #fff;
            box-shadow: 0 16px 32px rgba(248, 113, 113, 0.28);
        }

        .status-actions button.is-current.btn-success:disabled {
            box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.35);
        }

        .status-actions button.is-current.btn-danger:disabled {
            box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.3);
        }

        .status-actions button.is-current.btn-secondary:disabled {
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.25);
        }

        @keyframes selectPulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.02);
            }
            100% {
                transform: scale(1);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(18px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 16px;
            }

            .hero-top {
                flex-direction: column;
                align-items: flex-start;
            }

            .hero-pills {
                grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            }

            .admin-toolbar {
                flex-direction: column;
                align-items: stretch;
            }

            .toolbar-group {
                width: 100%;
            }

            .toolbar-group input[type="search"] {
                width: 100%;
            }

            .status-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>

    <div class="app-shell">
        <header class="surface-card hero-card">
            <div class="hero-top">
                <div class="hero-brand">
                    <span class="hero-symbol">ğŸ’¡</span>
                    <div>
                        <h1 class="hero-title">Ù†Ø¸Ø§Ù… Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</h1>
                        <p class="hero-description">Ù…Ù†ØµØ© Ù…ÙˆØ­Ø¯Ø© Ù…Ù† Ù‚Ø³Ù… Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø¨Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„Ù…Ø´ÙƒØ§Ø© ØªÙ…ÙƒÙ‘Ù† Ø§Ù„Ø·Ù„Ø§Ø¨ Ù…Ù† Ø¥ÙŠØµØ§Ù„ Ø£ÙÙƒØ§Ø±Ù‡Ù… ÙˆØªØªØ¨Ø¹ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ù„Ø­Ø¸Ø© Ø¨Ù„Ø­Ø¸Ø©ØŒ ÙˆØªÙ…Ù†Ø­ ÙØ±ÙŠÙ‚ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ­Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù„Ø§ØªØ®Ø§Ø° Ø§Ù„Ù‚Ø±Ø§Ø±.</p>
                    </div>
                </div>
                <div class="badge">
                    <span>ğŸš€ Ù†Ø³Ø®Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©</span>
                </div>
            </div>
            <div class="hero-pills">
                <div class="hero-pill">
                    <strong id="totalSuggestions">Ø¬Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„...</strong>
                    <small>Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù†ØµØ©</small>
                </div>
                <div class="hero-pill">
                    <strong id="pendingCount">â€”</strong>
                    <small>Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø´Ø±Ù</small>
                </div>
                <div class="hero-pill">
                    <strong id="approvedCount">â€”</strong>
                    <small>Ø£ÙÙƒØ§Ø± Ø¬Ø§Ù‡Ø²Ø©</small>
                </div>
                <div class="hero-pill">
                    <strong id="rejectedCount">â€”</strong>
                    <small>Ø¨Ø­Ø§Ø¬Ø© Ù„Ø¥Ø¹Ø§Ø¯Ø© ØµÙŠØ§ØºØ©</small>
                </div>
            </div>
        </header>

        <main>
            <section id="loginPage" class="view-section active">
                <div class="grid-split">
                    <div class="card">
                        <div class="section-heading">
                            <span>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨</span>
                            <h2>Ø´Ø§Ø±Ùƒ ÙÙƒØ±ØªÙƒ Ø®Ù„Ø§Ù„ Ø«ÙˆØ§Ù†Ù</h2>
                        </div>
                        <div class="form-grid">
                            <div>
                                <label for="studentId">Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© Ø£Ùˆ Ø§Ù„Ø³Ø¬Ù„</label>
                                <input type="text" id="studentId" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©" autocomplete="off">
                            </div>
                            <div>
                                <label for="studentPass">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                                <input type="password" id="studentPass" placeholder="Ø£Ø¯Ø®Ù„ Ø£ÙŠ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù„Ù„ØªØ¬Ø±Ø¨Ø©" autocomplete="off">
                            </div>
                        </div>
                          <div class="action-row" style="margin-top: 22px;">
                              <button type="button" onclick="studentLogin()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨</button>
                          </div>
                          <div class="helper-strip">
                              <strong>ğŸ›ˆ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ</strong>
                              <p>ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£ÙŠ Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© ÙˆØ£ÙŠ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù„Ø§Ø³ØªØ¹Ø±Ø§Ø¶ Ø§Ù„ØªØ¬Ø±Ø¨Ø©. ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù‚ØªØ±Ø§Ø­Ø§ØªÙƒ Ø¹Ù„Ù‰ Ø§Ù„Ù…ØªØµÙØ­ ÙÙ‚Ø·.</p>
                          </div>
                          <div style="margin-top: 18px;">
                              <button type="button" class="admin-access-cta" onclick="showAdminLogin()">ğŸ” Ù„Ø¯ÙŠ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
                          </div>
                    </div>
                    <div class="card">
                        <div class="section-heading">
                            <span>Ù„Ù…Ø§Ø°Ø§ Ø§Ù„Ù…Ù†ØµØ©ØŸ</span>
                            <h2>Ø±Ø­Ù„Ø© Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª ÙÙŠ Ø«Ù„Ø§Ø« Ø®Ø·ÙˆØ§Øª ÙˆØ§Ø¶Ø­Ø©</h2>
                        </div>
                        <div class="highlight-card">
                            <div>
                                <strong>Ù¡. Ø¥Ø±Ø³Ø§Ù„ Ø°ÙƒÙŠ</strong>
                                <p>Ø£Ø¯Ø®Ù„ Ø§Ù„ÙÙƒØ±Ø© ÙˆØ­Ø¯Ø¯ ÙØ¦ØªÙ‡Ø§ Ù„ØªØµÙ„ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¥Ù„Ù‰ Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ù…Ø®ØªØµ Ù…Ø¹ Ø®ØªÙ… Ø²Ù…Ù†ÙŠ ØªÙ…Ù‡ÙŠØ¯Ø§Ù‹ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©.</p>
                            </div>
                            <div>
                                <strong>Ù¢. Ù…ØªØ§Ø¨Ø¹Ø© ÙÙˆØ±ÙŠØ©</strong>
                                <p>Ø±Ø§Ù‚Ø¨ Ø­Ø§Ù„Ø© Ø§Ù‚ØªØ±Ø§Ø­Ùƒ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…Ø¹ Ø³Ø¬Ù„ Ø²Ù…Ù†ÙŠ ÙŠÙˆØ¶Ø­ ÙƒÙ„ ØªØ­Ø¯ÙŠØ«.</p>
                            </div>
                            <div>
                                <strong>Ù£. Ù‚Ø±Ø§Ø±Ø§Øª Ù…ÙˆØ«Ù‚Ø©</strong>
                                <p>ØªØ­ØµÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¹Ù„Ù‰ Ø£Ø¯ÙˆØ§Øª ØªØ­Ù„ÙŠÙ„ ÙˆÙ…Ø°ÙƒØ±Ø§Øª Ø§Ø¹ØªÙ…Ø§Ø¯ Ø£Ùˆ Ø§Ø¹ØªØ°Ø§Ø± Ù…Ø¹ ØªØ£Ø«ÙŠØ± ÙÙˆØ±ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø­ØµØ§Ø¡Ø§Øª.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="adminLoginPage" class="view-section">
                <div class="grid-split">
                    <div class="card">
                        <div class="section-heading">
                            <span>Ø¯Ø®ÙˆÙ„ Ù…Ø´Ø±Ù Ø§Ù„Ù†Ø¸Ø§Ù…</span>
                            <h2>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„ØªØ­Ù„ÙŠÙ„ ÙˆØ§ØªØ®Ø§Ø° Ø§Ù„Ù‚Ø±Ø§Ø±</h2>
                        </div>
                        <div class="form-grid">
                            <div>
                                <label for="adminUser">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                                <input type="text" id="adminUser" placeholder="Ø§ÙƒØªØ¨ admin" value="admin" autocomplete="username">
                            </div>
                            <div>
                                <label for="adminPass">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                                <input type="password" id="adminPass" placeholder="Ø§ÙƒØªØ¨ admin123" value="admin123" autocomplete="current-password">
                            </div>
                        </div>
                        <div class="action-row" style="margin-top: 22px;">
                            <button type="button" onclick="adminLogin()">Ø¯Ø®ÙˆÙ„ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
                            <button type="button" class="btn-secondary" onclick="showStudentLogin()">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø·Ù„Ø§Ø¨</button>
                        </div>
                        <div class="helper-strip">
                            <strong>ğŸ” Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©</strong>
                            <p>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: admin â€” ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: admin123. ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ ÙÙŠ Ø§Ù„ØªÙƒØ§Ù…Ù„ Ø§Ù„ÙØ¹Ù„ÙŠ.</p>
                        </div>
                    </div>
                    <div class="card">
                        <h3>Ù„Ù…Ø³Ø§Øª Ø¥Ø¯Ø§Ø±ÙŠØ© Ù…ØªÙ‚Ø¯Ù…Ø©</h3>
                        <ul class="status-legend" style="margin: 0; list-style: none; padding: 0;">
                            <li>ğŸ“ˆ Ø¥Ø­ØµØ§Ø¡Ø§Øª Ù„Ø­Ø¸ÙŠØ© Ù„Ø­Ø¬Ù… Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØ§Ù„ØªÙˆØ²ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø©.</li>
                            <li>ğŸ§­ ÙÙ„Ø§ØªØ± Ø³Ø±ÙŠØ¹Ø© Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø© Ø£Ùˆ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù†ØµÙŠ.</li>
                            <li>ğŸ“ Ø³Ø¬Ù„ Ù‚Ø±Ø§Ø±Ø§Øª Ù„ÙƒÙ„ Ø§Ù‚ØªØ±Ø§Ø­ Ù…Ø¹ Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ØªØµØ¯ÙŠØ±.</li>
                        </ul>
                    </div>
                </div>
            </section>

            <section id="studentPage" class="view-section">
                <div class="logout-row">
                    <button type="button" class="btn-outline" onclick="logout()">ğŸ‘‹ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
                </div>
                <div class="grid-split">
                    <div class="card">
                        <div class="section-heading">
                            <span id="studentWelcome">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø§Ù„Ø·Ø§Ù„Ø¨</span>
                            <h2>Ø¥Ø±Ø³Ø§Ù„ Ø§Ù‚ØªØ±Ø§Ø­ Ø¬Ø¯ÙŠØ¯</h2>
                        </div>
                        <div id="submissionFeedback" class="status-banner" style="display:none;"></div>
                        <div class="form-grid">
                            <div>
                                <label for="title">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­</label>
                                <input type="text" id="title" placeholder="Ù…Ø«Ø§Ù„: ØªØ­Ø³ÙŠÙ† Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø­Ø§Ø³Ø¨">
                            </div>
                            <div>
                                <label for="category">ØªØµÙ†ÙŠÙ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­</label>
                                <select id="category">
                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©</option>
                                    <option value="ØªØ¹Ù„ÙŠÙ…ÙŠ">ğŸ“š Ù…Ø¨Ø§Ø¯Ø±Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ©</option>
                                    <option value="Ø±ÙŠØ§Ø¶ÙŠ">âš½ Ù†Ø´Ø§Ø· Ø±ÙŠØ§Ø¶ÙŠ</option>
                                    <option value="Ø«Ù‚Ø§ÙÙŠ">ğŸ¨ Ù†Ø´Ø§Ø· Ø«Ù‚Ø§ÙÙŠ</option>
                                    <option value="Ø®Ø¯Ù…Ø§Øª">ğŸ› ï¸ Ø®Ø¯Ù…Ø© Ù…Ø¯Ø±Ø³ÙŠØ©</option>
                                    <option value="Ø£Ø®Ø±Ù‰">ğŸ“Œ Ø£Ø®Ø±Ù‰</option>
                                </select>
                            </div>
                            <div>
                                <label for="text">ÙˆØµÙ Ø§Ù„ÙÙƒØ±Ø©</label>
                                <textarea id="text" placeholder="ØµÙ Ø§Ù„ÙÙƒØ±Ø©ØŒ Ø§Ù„Ù‡Ø¯ÙØŒ ÙˆØ§Ù„ÙØ§Ø¦Ø¯Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©"></textarea>
                            </div>
                        </div>
                        <div class="action-row" style="margin-top: 22px;">
                            <button type="button" onclick="addSuggestion()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­</button>
                            <button type="button" class="btn-secondary" onclick="resetSuggestionForm()">Ù…Ø³Ø­ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª</button>
                        </div>
                        <div class="status-legend">
                            <div><span class="status-pill status-pending">â³ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span> ØªÙ… Ø§Ø³ØªÙ„Ø§Ù…Ù‡ Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ù‚Ø±Ø§Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©.</div>
                            <div><span class="status-pill status-approved">âœ… Ù…Ø¹ØªÙ…Ø¯</span> Ø³ÙŠØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ° ÙˆÙÙ‚ Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ù…ØªØ§Ø­Ø©.</div>
                            <div><span class="status-pill status-rejected">âŒ Ù…Ø¹Ø°Ø±Ø©Ù‹</span> ÙˆØµÙ„ Ø§Ø¹ØªØ°Ø§Ø± Ù…Ø¹ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù„Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù‚Ø§Ø¯Ù….</div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="section-heading">
                            <span>Ù„ÙˆØ­Ø© Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø·Ø§Ù„Ø¨</span>
                            <h2>Ø§Ù‚ØªØ±Ø§Ø­Ø§ØªÙŠ ÙˆØ®Ø· Ø³ÙŠØ±Ù‡Ø§</h2>
                        </div>
                        <div id="studentSnapshot" class="insights-grid" style="margin-bottom: 18px;"></div>
                        <div id="mySuggestions" class="suggestions-list"></div>
                    </div>
                </div>
            </section>

            <section id="adminPage" class="view-section">
                <div class="logout-row">
                    <button type="button" class="btn-outline" onclick="logout()">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
                </div>
                <div class="card" style="margin-bottom: 24px;">
                    <div class="section-heading" style="margin-bottom: 12px;">
                        <span id="adminWelcome">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø°ÙƒÙŠØ©</span>
                        <h2>Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª ÙˆØ¥ØµØ¯Ø§Ø± Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª</h2>
                    </div>
                    <div class="admin-toolbar">
                        <div class="toolbar-group">
                            <input type="search" id="adminSearch" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø¹Ù†ÙˆØ§Ù†ØŒ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø£Ùˆ Ø§Ù„ÙØ¦Ø©" />
                            <button type="button" class="btn-secondary" onclick="clearAdminFilters()">Ù…Ø³Ø­ Ø§Ù„ØªØµÙÙŠØ©</button>
                        </div>
                        <div class="toolbar-group" id="adminFilters">
                            <div class="filter-button active" data-filter="all">Ø§Ù„ÙƒÙ„</div>
                            <div class="filter-button" data-filter="pending">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</div>
                            <div class="filter-button" data-filter="approved">Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©</div>
                            <div class="filter-button" data-filter="rejected">Ø§Ù„Ù…Ø¹ØªØ°Ø± Ø¹Ù†Ù‡Ø§</div>
                        </div>
                        <div class="toolbar-group">
                            <button type="button" class="btn-outline" onclick="exportSuggestions()">â¬‡ï¸ ØªØµØ¯ÙŠØ± CSV</button>
                        </div>
                    </div>
                    <div class="insights-grid" id="adminInsights"></div>
                    <div id="categorySummary" class="distribution-list" style="margin-top: 20px;"></div>
                </div>
                <div class="card">
                    <div class="section-heading" style="margin-bottom: 12px;">
                        <span>Ø³Ø¬Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</span>
                        <h2 id="activeFilterLabel">ÙƒÙ„ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª</h2>
                    </div>
                    <div id="allSuggestions" class="suggestions-list"></div>
                </div>
            </section>
        </main>
    </div>

    <div id="toast" class="toast" role="status" aria-live="polite"></div>

    <script>
        const SUGGESTIONS_ENDPOINT = '/api/suggestions';

        const STATUS_CONFIG = {
            pending: {
                label: 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©',
                icon: 'â³',
                className: 'status-pill status-pending',
                actorDefault: 'Ø§Ù„Ù†Ø¸Ø§Ù…',
                note: 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ù‚Ø±Ø§Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©'
            },
            approved: {
                label: 'Ù…Ø¹ØªÙ…Ø¯',
                icon: 'âœ…',
                className: 'status-pill status-approved',
                actorDefault: 'Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©',
                note: 'ØªÙ… Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ù„Ù„ØªÙ†ÙÙŠØ°'
            },
            rejected: {
                label: 'ØªÙ… Ø§Ù„Ø§Ø¹ØªØ°Ø§Ø±',
                icon: 'âŒ',
                className: 'status-pill status-rejected',
                actorDefault: 'Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©',
                note: 'ØªÙ… Ø§Ù„Ø§Ø¹ØªØ°Ø§Ø± Ù…Ø¹ ØªÙˆØµÙŠØ© Ù„Ù„ØªØ­Ø³ÙŠÙ†'
            }
        };

        const CATEGORY_CONFIG = {
            'ØªØ¹Ù„ÙŠÙ…ÙŠ': 'ğŸ“š',
            'Ø±ÙŠØ§Ø¶ÙŠ': 'âš½',
            'Ø«Ù‚Ø§ÙÙŠ': 'ğŸ¨',
            'Ø®Ø¯Ù…Ø§Øª': 'ğŸ› ï¸',
            'Ø£Ø®Ø±Ù‰': 'ğŸ“Œ'
        };

        let suggestions = [];
        let currentUser = null;
        let adminFilter = 'all';
        let adminSearchTerm = '';
        let suggestionsLoaded = false;
        let suggestionsLoading = false;
        let suggestionsPromise = null;

          async function fetchSuggestionsFromServer() {
              try {
                  const response = await fetch(SUGGESTIONS_ENDPOINT, { cache: 'no-store' });
                  if (!response.ok) throw new Error(`HTTP ${response.status}`);
                  const data = await response.json();
                  const list = Array.isArray(data.suggestions) ? data.suggestions : [];
                  return list
                      .map(normalizeSuggestion)
                      .filter(Boolean)
                      .sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));
              } catch (error) {
                  console.warn('âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…:', error);
                  return [];
              }
          }

        function normalizeSuggestion(item) {
            if (!item || typeof item !== 'object') return null;
            const id = Number(item.id);
            if (!Number.isFinite(id)) return null;

            const status = ['pending', 'approved', 'rejected'].includes(item.status) ? item.status : 'pending';
            const createdAt = sanitizeDate(item.createdAt) || sanitizeDate(item.date) || new Date().toISOString();
            const updatedAt = sanitizeDate(item.updatedAt) || createdAt;

            let history = [];
            if (Array.isArray(item.history) && item.history.length) {
                history = item.history
                    .map(record => ({
                        status: ['pending', 'approved', 'rejected'].includes(record.status) ? record.status : status,
                        date: sanitizeDate(record.date) || createdAt,
                        actor: record.actor || (record.status === 'pending' ? 'Ø§Ù„Ù†Ø¸Ø§Ù…' : 'Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©'),
                        note: record.note || STATUS_CONFIG[record.status || status].note
                    }))
                    .sort((a, b) => new Date(a.date) - new Date(b.date));
            } else {
                history = [
                    {
                        status: status,
                        date: updatedAt,
                        actor: status === 'pending' ? 'Ø§Ù„Ù†Ø¸Ø§Ù…' : 'Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©',
                        note: STATUS_CONFIG[status].note
                    }
                ];
            }

            return {
                id,
                studentId: String(item.studentId || ''),
                studentName: String(item.studentName || ''),
                title: String(item.title || ''),
                text: String(item.text || ''),
                category: String(item.category || 'Ø£Ø®Ø±Ù‰'),
                status,
                createdAt,
                updatedAt,
                history
            };
        }

        function sanitizeDate(value) {
            if (!value) return null;
            const date = new Date(value);
            return Number.isFinite(date.getTime()) ? date.toISOString() : null;
        }

          async function ensureSuggestionsLoaded() {
              if (suggestionsLoaded) return;
              if (suggestionsPromise) {
                  await suggestionsPromise;
                  return;
              }
                suggestionsLoading = true;
                updateStats();
                suggestionsPromise = fetchSuggestionsFromServer().then((list) => {
                  suggestions = list;
                  suggestionsLoaded = true;
                  suggestionsLoading = false;
                  suggestionsPromise = null;
                  updateStats();
                  if (currentUser?.type === 'student') {
                      showMySuggestions();
                  }
                  if (currentUser?.type === 'admin') {
                      renderAdminInsights();
                      showAllSuggestions();
                  }
              }).catch(() => {
                  suggestions = [];
                  suggestionsLoaded = true;
                  suggestionsLoading = false;
                  suggestionsPromise = null;
                  updateStats();
              });
              await suggestionsPromise;
          }

        async function createSuggestionRemote(payload) {
            const response = await fetch(SUGGESTIONS_ENDPOINT, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            if (!response.ok) {
                const error = await response.json().catch(() => ({}));
                throw new Error(error.error || 'suggestion_store_failed');
            }
            const data = await response.json();
            return normalizeSuggestion(data.suggestion);
        }

        async function updateSuggestionRemote(id, status) {
            const response = await fetch(`${SUGGESTIONS_ENDPOINT}/${id}`, {
                method: 'PATCH',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ status })
            });
            if (!response.ok) {
                const error = await response.json().catch(() => ({}));
                throw new Error(error.error || 'suggestion_update_failed');
            }
            const data = await response.json();
            return normalizeSuggestion(data.suggestion);
        }

        async function studentLogin() {
            const id = document.getElementById('studentId').value.trim();
            const pass = document.getElementById('studentPass').value.trim();

            if (!id || !pass) {
                showToast('âŒ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
                return;
            }

            currentUser = {
                type: 'student',
                id,
                name: id ? `Ø·Ø§Ù„Ø¨ ${id.substring(0, 4)}` : 'Ø·Ø§Ù„Ø¨'
            };

            toggleView('loginPage', false);
            toggleView('studentPage', true);
            document.getElementById('studentWelcome').textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${currentUser.name}`;
            await ensureSuggestionsLoaded();
            showMySuggestions();
            renderStudentSnapshot();
            showToast('ğŸ‘‹ Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø¥Ø±Ø³Ø§Ù„ Ø§Ù‚ØªØ±Ø§Ø­Ùƒ.');
        }

        async function adminLogin() {
            const user = document.getElementById('adminUser').value.trim();
            const pass = document.getElementById('adminPass').value.trim();

            if (user !== 'admin' || pass !== 'admin123') {
                showToast('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
                return;
            }

            currentUser = { type: 'admin', name: 'Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©' };
            adminFilter = 'all';
            adminSearchTerm = '';
            document.getElementById('adminSearch').value = '';

            toggleView('adminLoginPage', false);
            toggleView('adminPage', true);
            document.getElementById('adminWelcome').textContent = 'Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø°ÙƒÙŠØ© â€” Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ…';
            updateAdminFiltersUI();
            await ensureSuggestionsLoaded();
            renderAdminInsights();
            showAllSuggestions();
            showToast('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©');
        }

        async function addSuggestion() {
            if (!currentUser || currentUser.type !== 'student') {
                showToast('âš ï¸ ÙŠÙ„Ø²Ù… ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }
            await ensureSuggestionsLoaded();

            const title = document.getElementById('title').value.trim();
            const text = document.getElementById('text').value.trim();
            const category = document.getElementById('category').value;

            if (!title || !text || !category) {
                showToast('âŒ ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return;
            }

            const payload = {
                studentId: currentUser.id,
                studentName: currentUser.name,
                title,
                text,
                category
            };

            try {
                showToast('â³ Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­...');
                const record = await createSuggestionRemote(payload);
                if (!record) {
                    throw new Error('invalid_record');
                }
                suggestions.push(record);
                suggestions.sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));
                resetSuggestionForm();
                updateStats();
                showMySuggestions();
                renderStudentSnapshot();
                displaySubmissionFeedback(record);
                showToast('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­ Ø¨Ù†Ø¬Ø§Ø­! Ø³ØªØªÙ„Ù‚Ù‰ Ù…Ø³ØªØ¬Ø¯Ø§ØªÙ‡ Ù‡Ù†Ø§.');
            } catch (error) {
                console.warn('âš ï¸ ØªØ¹Ø°Ø± Ø­ÙØ¸ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­:', error);
                showToast('ØªØ¹Ø°Ø± Ø­ÙØ¸ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­ Ø­Ø§Ù„ÙŠØ§Ù‹ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
            }
        }

        async function changeStatus(id, status) {
            await ensureSuggestionsLoaded();
            const suggestion = suggestions.find(item => item.id === id);
            if (!suggestion) return;
            if (suggestion.status === status) {
                showToast('â„¹ï¸ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù…Ø·Ø¨Ù‚Ø© Ø¨Ø§Ù„ÙØ¹Ù„.');
                return;
            }

            try {
                const updatedRecord = await updateSuggestionRemote(id, status);
                if (!updatedRecord) {
                    throw new Error('invalid_record');
                }
                const index = suggestions.findIndex(item => item.id === id);
                if (index !== -1) {
                    suggestions[index] = updatedRecord;
                }
                updateStats();

                if (currentUser && currentUser.type === 'admin') {
                    showAllSuggestions();
                    renderAdminInsights();
                }

                if (currentUser && currentUser.type === 'student' && currentUser.id === updatedRecord.studentId) {
                    showMySuggestions();
                    renderStudentSnapshot();
                    displaySubmissionFeedback(updatedRecord);
                }

                const statusMessage = status === 'approved'
                    ? 'âœ… ØªÙ… Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­'
                    : status === 'rejected'
                        ? 'âŒ ØªÙ… Ø§Ù„Ø§Ø¹ØªØ°Ø§Ø± Ø¹Ù† Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­'
                        : 'â„¹ï¸ ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø§Ù„Ø© Ø¥Ù„Ù‰ Ù‚ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©';
                showToast(statusMessage);
            } catch (error) {
                console.warn('âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©:', error);
                showToast('ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­ Ø­Ø§Ù„ÙŠØ§Ù‹.');
            }
        }

        function showMySuggestions() {
            const container = document.getElementById('mySuggestions');
            if (!currentUser || currentUser.type !== 'student') return;
            const my = suggestions.filter(s => s.studentId === currentUser.id)
                .sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));

            if (!my.length) {
                container.innerHTML = `
                    <div class="empty-state">
                        <p>ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø¨Ø¹Ø¯.</p>
                        <p>Ø§Ø¨Ø¯Ø£ Ø¨Ù…Ø´Ø§Ø±ÙƒØ© ÙÙƒØ±ØªÙƒ Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ø­Ø§Ù„Ø© ÙˆØ§Ù„Ø­Ø±ÙƒØ§Øª Ø§Ù„Ø²Ù…Ù†ÙŠØ© Ù‡Ù†Ø§.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = my.map(renderSuggestionCard).join('');
        }

        function showAllSuggestions() {
            const container = document.getElementById('allSuggestions');
            if (!container) return;
            const filtered = getFilteredSuggestions();

            document.getElementById('activeFilterLabel').textContent = adminFilter === 'all'
                ? 'ÙƒÙ„ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª'
                : `Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª â€” ${STATUS_CONFIG[adminFilter].label}`;

            if (!filtered.length) {
                container.innerHTML = `
                    <div class="empty-state">
                        <p>ğŸ” Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ø¹ÙˆØ§Ù…Ù„ Ø§Ù„ØªØµÙÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©.</p>
                        <p>Ø¬Ø±Ù‘Ø¨ ØªØºÙŠÙŠØ± Ø§Ù„ÙØ¦Ø© Ø£Ùˆ Ø§Ù„Ø¨Ø­Ø« Ø¨Ù…ØµØ·Ù„Ø­Ø§Øª Ù…Ø®ØªÙ„ÙØ©.</p>
                    </div>`;
                return;
            }

            container.innerHTML = filtered.map(suggestion => {
                const statusCfg = STATUS_CONFIG[suggestion.status];
                const isApproved = suggestion.status === 'approved';
                const isPending = suggestion.status === 'pending';
                const isRejected = suggestion.status === 'rejected';
                return `
                    <div class="suggestion-item" data-suggestion-id="${suggestion.id}" data-status="${suggestion.status}">
                        <div class="suggestion-header">
                            <div>
                                <h3 class="suggestion-title">${statusCfg.icon} ${suggestion.title}</h3>
                                <div class="suggestion-meta">
                                    <span class="badge">ğŸ‘¤ ${suggestion.studentName} â€“ ${suggestion.studentId}</span>
                                    <span class="badge">${CATEGORY_CONFIG[suggestion.category] || 'ğŸ“Œ'} ${suggestion.category}</span>
                                    <span class="badge">ğŸ“… ${formatDate(suggestion.updatedAt)}</span>
                                </div>
                            </div>
                            <span class="${statusCfg.className}">${statusCfg.icon} ${statusCfg.label}</span>
                        </div>
                        <p class="suggestion-text">${escapeHtml(suggestion.text)}</p>
                        ${renderTimeline(suggestion.history)}
                        <div class="status-actions" role="group" aria-label="ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­">
                            <button type="button" class="btn-success${isApproved ? ' is-current' : ''}" onclick="changeStatus(${suggestion.id}, 'approved')" ${isApproved ? 'disabled aria-pressed="true"' : 'aria-pressed="false"'}>âœ… Ø§Ø¹ØªÙ…Ø§Ø¯</button>
                            <button type="button" class="btn-secondary${isPending ? ' is-current' : ''}" onclick="changeStatus(${suggestion.id}, 'pending')" ${isPending ? 'disabled aria-pressed="true"' : 'aria-pressed="false"'}>â³ Ø¥Ø±Ø¬Ø§Ø¹ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</button>
                            <button type="button" class="btn-danger${isRejected ? ' is-current' : ''}" onclick="changeStatus(${suggestion.id}, 'rejected')" ${isRejected ? 'disabled aria-pressed="true"' : 'aria-pressed="false"'}>âŒ Ø§Ø¹ØªØ°Ø§Ø±</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderSuggestionCard(suggestion) {
            const statusCfg = STATUS_CONFIG[suggestion.status];
            return `
                <div class="suggestion-item">
                    <div class="suggestion-header">
                        <div>
                            <h3 class="suggestion-title">${statusCfg.icon} ${suggestion.title}</h3>
                            <div class="suggestion-meta">
                                <span class="badge">${CATEGORY_CONFIG[suggestion.category] || 'ğŸ“Œ'} ${suggestion.category}</span>
                                <span class="badge">ğŸ“… ${formatDate(suggestion.updatedAt)}</span>
                            </div>
                        </div>
                        <span class="${statusCfg.className}">${statusCfg.icon} ${statusCfg.label}</span>
                    </div>
                    <p class="suggestion-text">${escapeHtml(suggestion.text)}</p>
                    ${renderTimeline(suggestion.history)}
                </div>
            `;
        }

        function renderTimeline(history) {
            if (!history || !history.length) return '';
            const sorted = [...history].sort((a, b) => new Date(a.date) - new Date(b.date));
            return `
                <div class="timeline">
                    ${sorted.map(step => {
                        const cfg = STATUS_CONFIG[step.status] || STATUS_CONFIG.pending;
                        return `
                            <div class="timeline-step">
                                <strong>${cfg.icon} ${cfg.label}</strong>
                                <small>${formatDate(step.date)} â€” ${step.actor || 'Ø§Ù„Ù†Ø¸Ø§Ù…'}</small>
                                <p style="margin: 6px 0 0; color: var(--text-muted);">${escapeHtml(step.note || cfg.note)}</p>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function renderStudentSnapshot() {
            const container = document.getElementById('studentSnapshot');
            if (!container || !currentUser || currentUser.type !== 'student') return;
            const mySuggestions = suggestions.filter(s => s.studentId === currentUser.id);
            if (!mySuggestions.length) {
                container.innerHTML = '';
                return;
            }

            const pending = mySuggestions.filter(s => s.status === 'pending').length;
            const approved = mySuggestions.filter(s => s.status === 'approved').length;
            const rejected = mySuggestions.filter(s => s.status === 'rejected').length;
            const lastUpdate = mySuggestions
                .slice()
                .sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt))[0];

            const chips = [];
            if (pending) chips.push('â³ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©');
            if (approved) chips.push('âœ… Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„ØªÙ†ÙÙŠØ°');
            if (rejected) chips.push('ğŸ’¡ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø¨Ø­Ø§Ø¬Ø© Ù„Ø¥Ø¹Ø§Ø¯Ø© ØµÙŠØ§ØºØ©');
            if (!chips.length) chips.push('ÙƒÙ„ Ø§Ù‚ØªØ±Ø§Ø­Ø§ØªÙƒ Ù…Ø­Ø¯Ø«Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.');

            const summaryText = pending
                ? 'Ù‡Ù†Ø§Ùƒ Ø£ÙÙƒØ§Ø± Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø´Ø±Ù. Ø³Ù†Ø±Ø³Ù„ Ù„Ùƒ ØªÙ†Ø¨ÙŠÙ‡Ø§Ù‹ Ø¹Ù†Ø¯ ÙƒÙ„ ØªØ­Ø¯ÙŠØ«.'
                : 'ÙƒÙ„ Ø§Ù„Ø£ÙÙƒØ§Ø± Ø§Ù„ØªÙŠ Ø£Ø±Ø³Ù„ØªÙ‡Ø§ ØªÙ… Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹Ù‡Ø§ Ø­ØªÙ‰ Ø§Ù„Ù„Ø­Ø¸Ø©.';

            container.innerHTML = `
                <div class="highlight-card">
                    <div><strong>Ù…Ù„Ø®Øµ Ø§Ù‚ØªØ±Ø§Ø­Ø§ØªÙƒ</strong><p>${summaryText}</p></div>
                    <div class="insight-row">
                        ${chips.map(chip => `<span class="chip">${chip}</span>`).join('')}
                    </div>
                    <div>
                        <strong>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«</strong>
                        <p>${lastUpdate ? formatDate(lastUpdate.updatedAt) : 'â€”'}</p>
                    </div>
                </div>
            `;
        }

        function renderAdminInsights() {
            const container = document.getElementById('adminInsights');
            if (!container) return;
            const pending = suggestions.filter(s => s.status === 'pending').length;
            const approved = suggestions.filter(s => s.status === 'approved').length;
            const rejected = suggestions.filter(s => s.status === 'rejected').length;
            const recent = suggestions.slice().sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt))[0];

            const summaryText = pending
                ? 'Ù‡Ù†Ø§Ùƒ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª ØªØ­ØªØ§Ø¬ Ù‚Ø±Ø§Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø®Ù„Ø§Ù„ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù‚Ø±ÙŠØ¨Ø©.'
                : 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‘Ù‚Ø© Ø­Ø§Ù„ÙŠØ§Ù‹. ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªÙ†ÙÙŠØ°.';

            const chips = [
                pending ? 'â³ Ø¨Ù†Ùƒ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù†Ø´Ø·' : 'â³ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‘Ù‚Ø©',
                approved ? 'âœ… Ø£ÙÙƒØ§Ø± Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„ØªØ·Ø¨ÙŠÙ‚' : 'âœ… Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù‚Ø§Ø¯Ù…',
                rejected ? 'ğŸ’¡ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø¨Ø­Ø§Ø¬Ø© Ù„Ø¥Ø¹Ø§Ø¯Ø© ØµÙŠØ§ØºØ©' : 'ğŸ’¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙÙƒØ§Ø± Ø¶Ù…Ù† Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ØµØ­ÙŠØ­'
            ];

            container.innerHTML = `
                <div class="highlight-card">
                    <div><strong>Ù…Ù„Ø®Øµ Ø§Ù„ÙŠÙˆÙ…</strong><p>${summaryText}</p></div>
                    <div class="insight-row">
                        ${chips.map(chip => `<span class="chip">${chip}</span>`).join('')}
                    </div>
                    <div><strong>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«</strong><p>${recent ? `${formatDate(recent.updatedAt)} â€” ${recent.title}` : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¨Ø¹Ø¯.'}</p></div>
                </div>
            `;

            renderCategorySummary();
        }

        function renderCategorySummary() {
            const container = document.getElementById('categorySummary');
            if (!container) return;
            if (!suggestions.length) {
                container.innerHTML = '';
                return;
            }

            const counts = suggestions.reduce((acc, item) => {
                acc[item.category] = (acc[item.category] || 0) + 1;
                return acc;
            }, {});
            const total = suggestions.length;

              container.innerHTML = Object.entries(counts).map(([category, count]) => {
                const icon = CATEGORY_CONFIG[category] || 'ğŸ“Œ';
                const percent = Math.round((count / total) * 100);
                  const descriptor = percent >= 60 ? 'Ù†Ø´Ø§Ø· Ù…Ø±ØªÙØ¹'
                      : percent >= 30 ? 'Ù†Ø´Ø§Ø· Ù…ØªÙˆØ³Ø·'
                      : 'Ù†Ø´Ø§Ø· Ù…Ø­Ø¯ÙˆØ¯';
                return `
                    <div>
                        <div class="distribution-item">
                            <span>${icon} ${category}</span>
                              <strong>${descriptor}</strong>
                        </div>
                        <div class="progress-bar"><span style="width:${percent}%"></span></div>
                    </div>
                `;
            }).join('');
        }

        function getFilteredSuggestions() {
            return suggestions
                .filter(item => adminFilter === 'all' || item.status === adminFilter)
                .filter(item => {
                    if (!adminSearchTerm) return true;
                    const haystack = `${item.title} ${item.text} ${item.studentName} ${item.studentId} ${item.category}`.toLowerCase();
                    return haystack.includes(adminSearchTerm.toLowerCase());
                })
                .sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));
        }

        function updateStats() {
            const total = suggestions.length;
            const pending = suggestions.filter(s => s.status === 'pending').length;
            const approved = suggestions.filter(s => s.status === 'approved').length;
            const rejected = suggestions.filter(s => s.status === 'rejected').length;

            const totalEl = document.getElementById('totalSuggestions');
            const pendingEl = document.getElementById('pendingCount');
            const approvedEl = document.getElementById('approvedCount');
            const rejectedEl = document.getElementById('rejectedCount');

            if (totalEl) {
                totalEl.textContent = suggestionsLoading ? 'Ø¬Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„...' : total ? 'Ù…Ù†ØµØ© Ù†Ø´Ø·Ø©' : 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù‚ØªØ±Ø§Ø­Ø§ØªÙƒÙ…';
            }
            if (pendingEl) {
                pendingEl.textContent = pending ? 'Ø·Ù„Ø¨Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©' : 'Ù„Ø§ Ù…Ù‡Ø§Ù… Ù…Ø¹Ù„Ù‘Ù‚Ø©';
            }
            if (approvedEl) {
                approvedEl.textContent = approved ? 'Ù…Ø¨Ø§Ø¯Ø±Ø§Øª Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„ØªÙ†ÙÙŠØ°' : 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯';
            }
            if (rejectedEl) {
                rejectedEl.textContent = rejected ? 'Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª ØªØ­ØªØ§Ø¬ ØªØ·ÙˆÙŠØ±' : 'ÙƒÙ„ Ø§Ù„Ø£ÙÙƒØ§Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ØµØ­ÙŠØ­';
            }

            if (currentUser && currentUser.type === 'student') {
                renderStudentSnapshot();
            }
            if (currentUser && currentUser.type === 'admin') {
                renderAdminInsights();
                showAllSuggestions();
            }
        }

        function toggleView(id, show) {
            const section = document.getElementById(id);
            if (!section) return;
            if (show) {
                section.classList.add('active');
            } else {
                section.classList.remove('active');
            }
        }

        function performLogout() {
            currentUser = null;
            toggleView('studentPage', false);
            toggleView('adminPage', false);
            toggleView('adminLoginPage', false);
            toggleView('loginPage', true);
            resetStudentForm();
            resetSuggestionForm();
            const banner = document.getElementById('submissionFeedback');
            if (banner) banner.style.display = 'none';
            const studentList = document.getElementById('mySuggestions');
            if (studentList) studentList.innerHTML = '';
            const snapshot = document.getElementById('studentSnapshot');
            if (snapshot) snapshot.innerHTML = '';
            adminFilter = 'all';
            adminSearchTerm = '';
            const searchInput = document.getElementById('adminSearch');
            if (searchInput) searchInput.value = '';
            updateAdminFiltersUI();
            showToast('ğŸ‘‹ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŒ Ù†ØªØ·Ù„Ø¹ Ù„Ø±Ø¤ÙŠØªÙƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹.');
        }

        function showAdminLogin() {
            toggleView('loginPage', false);
            toggleView('adminLoginPage', true);
        }

        function showStudentLogin() {
            toggleView('adminLoginPage', false);
            toggleView('loginPage', true);
        }

        function resetStudentForm() {
            document.getElementById('studentId').value = '';
            document.getElementById('studentPass').value = '';
        }

        function resetSuggestionForm() {
            document.getElementById('title').value = '';
            document.getElementById('text').value = '';
            document.getElementById('category').value = '';
        }

        function displaySubmissionFeedback(suggestion) {
            const banner = document.getElementById('submissionFeedback');
            if (!banner) return;
            const cfg = STATUS_CONFIG[suggestion.status];
            banner.innerHTML = `
                <strong>${cfg.icon} ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù‚ØªØ±Ø§Ø­Ùƒ</strong>
                <div style="margin-top: 6px;">Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: ${cfg.label}. Ø³Ù†Ø¨Ù„ØºÙƒ Ø¹Ù†Ø¯ Ø§ØªØ®Ø§Ø° Ø§Ù„Ù‚Ø±Ø§Ø±.</div>
            `;
            banner.style.display = 'block';
        }

        function updateAdminFiltersUI() {
            const buttons = document.querySelectorAll('#adminFilters .filter-button');
            buttons.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.filter === adminFilter);
            });
        }

        document.getElementById('adminFilters')?.addEventListener('click', (event) => {
            const button = event.target.closest('.filter-button');
            if (!button) return;
            adminFilter = button.dataset.filter;
            updateAdminFiltersUI();
            showAllSuggestions();
        });

        document.getElementById('adminSearch')?.addEventListener('input', (event) => {
            adminSearchTerm = event.target.value;
            showAllSuggestions();
        });

        function clearAdminFilters() {
            adminFilter = 'all';
            adminSearchTerm = '';
            const searchInput = document.getElementById('adminSearch');
            if (searchInput) searchInput.value = '';
            updateAdminFiltersUI();
            showAllSuggestions();
        }

        function exportSuggestions() {
            if (!suggestions.length) {
                showToast('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ± Ø­Ø§Ù„ÙŠØ§Ù‹');
                return;
            }
            const header = ['id', 'studentId', 'studentName', 'title', 'text', 'category', 'status', 'createdAt', 'updatedAt'];
            const rows = suggestions.map(s => header.map(key => `"${String((s[key] ?? '')).replace(/"/g, '""')}"`).join(','));
            const csv = [header.join(','), ...rows].join('\n');
            const blob = new Blob(["\ufeff" + csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'student-suggestions.csv';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            showToast('â¬‡ï¸ ØªÙ… ØªØ¬Ù‡ÙŠØ² Ù…Ù„Ù CSV');
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            if (!toast) return;
            toast.textContent = message;
            toast.classList.add('show');
            clearTimeout(showToast.timeoutId);
            showToast.timeoutId = setTimeout(() => {
                toast.classList.remove('show');
            }, 3600);
        }

        function escapeHtml(str) {
            return String(str)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
        }

        function formatDate(dateString) {
            if (!dateString) return 'â€”';
            const date = new Date(dateString);
            if (!Number.isFinite(date.getTime())) return 'â€”';
            return date.toLocaleString('ar-SA', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        document.addEventListener('visibilitychange', async () => {
            if (document.visibilityState !== 'visible') return;
            suggestionsLoading = true;
            updateStats();
            const list = await fetchSuggestionsFromServer();
            suggestions = list;
            suggestionsLoaded = true;
            suggestionsLoading = false;
            updateStats();
            if (currentUser?.type === 'student') {
                showMySuggestions();
            }
            if (currentUser?.type === 'admin') {
                renderAdminInsights();
                showAllSuggestions();
            }
        });

        ensureSuggestionsLoaded();

        // Expose functions to the global scope for inline handlers
        window.addSuggestion = addSuggestion;
        window.changeStatus = changeStatus;
        window.studentLogin = studentLogin;
        window.adminLogin = adminLogin;
        window.logout = () => {
            performLogout();
        };
        window.showAdminLogin = showAdminLogin;
        window.showStudentLogin = showStudentLogin;
        window.resetStudentForm = resetStudentForm;
        window.resetSuggestionForm = resetSuggestionForm;
        window.clearAdminFilters = clearAdminFilters;
        window.exportSuggestions = exportSuggestions;
    </script>
</body>
</html>
